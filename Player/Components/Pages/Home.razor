@page "/"

@inject ISpeakerApi Speaker
@inject StreamStore StreamStore
@inject ILogger<Home> Logger

<PageTitle>Controls</PageTitle>

<MudContainer MaxWidth="MaxWidth.Small" >
    <MudStack Spacing="4">
        @if (!string.IsNullOrWhiteSpace(_errorMessage))
        {
            <MudAlert Severity="Severity.Error" Variant="Variant.Filled" CloseIcon="@Icons.Material.Filled.Close" CloseIconClicked="() => _errorMessage = null">
                @_errorMessage
            </MudAlert>
        }
        else if (!string.IsNullOrWhiteSpace(_successMessage))
        {
@*             <MudAlert Severity="Severity.Success" Variant="Variant.Filled" CloseIcon="@Icons.Material.Filled.Close" CloseIconClicked="() => _successMessage = null">
                @_successMessage
            </MudAlert>
 *@        }

        <MudPaper Elevation="2" Class="pa-4">
            <MudStack Spacing="3">
                <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                    <MudText Typo="Typo.h6">Volume</MudText>
                    <MudButton Variant="Variant.Text" Disabled="@_isBusy" StartIcon="@Icons.Material.Filled.Refresh" OnClick="() => RefreshStatusAsync(false, true)">Refresh</MudButton>
                </MudStack>
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="3">
                    <MudSlider T="int" Value="_volume" Min="0" Max="100" Step="1" Disabled="@_isBusy" Color="Color.Primary" ValueChanged="@OnVolumeChangedAsync" Style="flex:1; min-width:220px;" />
                    <MudText Class="volume-value">@_volume%</MudText>
                </MudStack>
                <MudStack Row="true" Spacing="2">
                    <MudButton Variant="Variant.Text" Disabled="@_isBusy" StartIcon="@Icons.Material.Filled.VolumeDown" OnClick="VolumeDownAsync">-6</MudButton>
                    <MudButton Variant="Variant.Text" Disabled="@_isBusy" StartIcon="@(_status?.IsMuted == true ? Icons.Material.Filled.VolumeOff : Icons.Material.Filled.VolumeUp)" OnClick="ToggleMuteAsync">@(_status?.IsMuted == true ? "Unmute" : "Mute")</MudButton>
                    <MudButton Variant="Variant.Text" Disabled="@_isBusy" StartIcon="@Icons.Material.Filled.VolumeUp" OnClick="VolumeUpAsync">+6</MudButton>
                </MudStack>
            </MudStack>
        </MudPaper>

        <MudPaper Elevation="2" Class="pa-4">
            <MudStack Spacing="3">
                <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                    <MudText Typo="Typo.h6">Saved Streams</MudText>
                    <MudButton Variant="Variant.Text" StartIcon="@Icons.Material.Filled.List" Href="/streams">Manage Streams</MudButton>
                </MudStack>
                @if (_streams.Count == 0)
                {
                    <MudText>No streams saved.</MudText>
                }
                else
                {
                    <MudStack Spacing="2">
                        @foreach (var stream in _streams)
                        {
                            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2" Class="stream-row">
                                <MudText Typo="Typo.body1" Style="flex:1">@stream.Name</MudText>
                                <MudButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Small" Disabled="@_isBusy" StartIcon="@Icons.Material.Filled.PlayArrow" OnClick="() => PlaySavedStream(stream)">Play</MudButton>
                            </MudStack>
                        }
                    </MudStack>
                }
            </MudStack>
        </MudPaper>
    </MudStack>
</MudContainer>


